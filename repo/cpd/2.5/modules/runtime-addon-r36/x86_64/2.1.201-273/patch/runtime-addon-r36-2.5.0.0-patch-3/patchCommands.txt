patch cm runtime-addon-r36 -p '{"data": {"jupyter-r36-server.json": "{\"displayName\": \"Jupyter with R 3.6\",\"description\": \"Jupyter Notebook Server with R 3.6\",\"annotations\": [{\"name\": \"productId\",\"value\": \"IBM Watson Studio Local Services for IBM Cloud Pak for Data\"},{\"name\": \"productName\",\"value\": \"IBM Watson Studio Local\"},{\"name\": \"productVersion\",\"value\": \"2.5\"}],\"author\": \"IBM\",\"tested\": true,\"isService\": true,\"features\": [\"environment\", \"r\"],\"runtimeType\": \"jupyter-r36\",\"portMappings\": [{\"servicePort\": 8888,\"containerPort\": 8888,\"protocol\": \"TCP\"},{\"servicePort\": 8889,\"containerPort\": 8889,\"protocol\": \"TCP\"}],\"replicas\": 1,\"image\": \"{{ .DockerRegistryPrefix }}/wslocal-x86-runtime-r36:runtime-addon-r36-2.5.0.0-patch-3\",\"command\": [\"/opt/ibm/ws/bin/setup_container.sh\"],\"volumes\": [{\"volume\": \"scripts\",\"mountPath\": \"/cc-home/.scripts\",\"subPath\": \".scripts\",\"readOnly\": true,\"claimName\": \"cc-home-pvc\"},{\"volume\": \"dbdrivers\",\"mountPath\": \"/user-home/_global_/dbdrivers\",\"subPath\": \"_global_/dbdrivers\",\"readOnly\": true,\"claimName\": \"user-home-pvc\"},{\"volume\": \"rlibs\",\"mountPath\": \"/cc-home/_global_/R\",\"subPath\": \"_global_/R\",\"readOnly\": true,\"claimName\": \"cc-home-pvc\"},{\"volume\": \"truststores\",\"mountPath\": \"/cc-home/_global_/security/customer-truststores\",\"subPath\": \"_global_/security/customer-truststores\",\"readOnly\": true,\"claimName\": \"cc-home-pvc\"},{\"volume\": \"remoteimages\",\"mountPath\": \"/cc-home/_global_/.remote-images\",\"subPath\": \"_global_/.remote-images\",\"claimName\": \"cc-home-pvc\"},{\"volume\": \"project_dir\",\"mountPath\": \"/project_data/data_asset\",\"claimName\": \"file-api-claim\",\"subPath\": \"projects/$project_id/assets/data_asset\"},{\"volume\": \"notebookscript\",\"mountPath\": \"/opt/ibm/ws\",\"claimName\": \"cc-home-pvc\",\"readOnly\": true,\"subPath\": \"_global_/config/.notebookscripts/active_scripts\"},{\"volume\": \"user-home-conda\",\"mountPath\": \"/user-home/_global_/config/conda\",\"claimName\": \"user-home-pvc\",\"readOnly\": true,\"subPath\": \"_global_/config/conda\"},{\"volume\": \"cc-home-conda\",\"mountPath\": \"/cc-home/_global_/config/conda\",\"claimName\": \"cc-home-pvc\",\"readOnly\": true,\"subPath\": \"_global_/config/conda\"}],\"probes\": {\"liveness\": {\"path\": \"/api/monitor\",\"scheme\": \"https\",\"port\": 8889,\"initialDelaySeconds\": 120,\"timeoutSeconds\": 20,\"periodSeconds\": 60,\"failureThreshold\": 6},\"readiness\": {\"path\": \"/api/monitor\",\"scheme\": \"https\",\"port\": 8889,\"initialDelaySeconds\": 15,\"timeoutSeconds\": 10,\"periodSeconds\": 10}},\"resources\": {\"cpu\": {\"request\": -1,\"minimum\": 1000},\"gpu\": {\"request\": -1,\"minimum\": 0},\"memory\": {\"request\": -1,\"minimum\": 2048},\"duration\": {\"value\": -1,\"units\": \"unix\"}}}"}}'
run prepull-r36-patched-image-job --image {{ .DockerRegistryPrefix }}/wslocal-x86-runtime-r36:runtime-addon-r36-2.5.0.0-patch-3 --restart OnFailure --overrides '{ "spec": {  "backoffLimit": 6,  "completions": 50,  "parallelism": 50,  "template": {"metadata": { "labels": {  "app": "imagePrepull",  "run": "patched-image-r36" }},"spec": { "affinity": {  "nodeAffinity": {"requiredDuringSchedulingIgnoredDuringExecution": { "nodeSelectorTerms": [{  "matchExpressions": [{"key": "beta.kubernetes.io/arch","operator": "In","values": ["amd64"]  }] }]}  },  "podAntiAffinity": {"requiredDuringSchedulingIgnoredDuringExecution": [{ "labelSelector": {  "matchExpressions": [{"key": "run","operator": "In","values": ["patched-image-r36"]  }] }, "topologyKey": "kubernetes.io/hostname"}]  } }, "containers": [{  "command": ["echo", "Image preloaded"],  "image": "{{ .DockerRegistryPrefix }}/wslocal-x86-runtime-r36:runtime-addon-r36-2.5.0.0-patch-3",  "imagePullPolicy": "Always",  "name": "patched-image-r36-container" }]}  } }}'
run patched-copycm-job-r36 --image {{ .DockerRegistryPrefix }}/environments-init-job:runtime-addon-r36-2.5.0.0-patch-3 --replicas 1 --restart OnFailure --overrides '{"spec": {"template": {"spec": {"affinity": {"nodeAffinity": {"requiredDuringSchedulingIgnoredDuringExecution": {"nodeSelectorTerms": [{"matchExpressions": [{"key": "beta.kubernetes.io/arch","operator": "In","values": ["amd64"]}]}]}}},"containers": [{"command": ["/bin/bash", "-c", "/home/node/scripts/initializeNotebooks.sh --copyRTDEF=true"],"image": "{{.DockerRegistryPrefix }}/environments-init-job:runtime-addon-r36-2.5.0.0-patch-3","env": [{"name": "RUNTIME_DEF_SOURCE_PATH","value": "/tmp/runtimedefinition/..data/jupyter-r36-server.json"}, {"name": "RUNTIME_DEF_TARGET_PATH","value": "/user-home/_global_/config/.runtime-definitions/ibm/jupyter-r36-server.json"}],"imagePullPolicy": "Always","name": "patched-init-job-container","resources": {"limits": {"cpu": "200m","memory": "64Mi"},"requests": {"cpu": "100m","memory": "32Mi"}},"securityContext": {"allowPrivilegeEscalation": false,"capabilities": {"drop": ["ALL"]},"privileged": false,"readOnlyRootFilesystem": false,"runAsNonRoot": true},"volumeMounts": [{"mountPath": "/tmp/runtimedefinition","name": "rt-def-cm"}]}],"restartPolicy": "OnFailure","securityContext": {"runAsNonRoot": true,"runAsUser": 1000320999},"serviceAccount": "cpd-editor-sa","serviceAccountName": "cpd-editor-sa","volumes": [{"name": "rt-def-cm","configMap": {"name": "runtime-addon-r36"}}]}}}}'
run patched-copyscripts-job-r36 --image {{ .DockerRegistryPrefix }}/environments-init-job:runtime-addon-r36-2.5.0.0-patch-3 --replicas 1 --restart OnFailure --overrides '{"spec": {"template": {"spec": {"affinity": {"nodeAffinity": {"requiredDuringSchedulingIgnoredDuringExecution": {"nodeSelectorTerms": [{"matchExpressions": [{"key": "beta.kubernetes.io/arch","operator": "In","values": ["amd64"]}]}]}}},"containers": [{"command": ["/bin/bash", "-c", "/home/node/scripts/initializeNotebooks.sh --copyscripts=true"],"image": "{{.DockerRegistryPrefix }}/environments-init-job:runtime-addon-r36-2.5.0.0-patch-3","env": [{"name": "APP_ENV_SCRIPTS_VERSION","value": "1029"}],"imagePullPolicy": "Always","name": "patched-init-job-container","resources": {"limits": {"cpu": "200m","memory": "64Mi"},"requests": {"cpu": "100m","memory": "32Mi"}},"securityContext": {"allowPrivilegeEscalation": false,"capabilities": {"drop": ["ALL"]},"privileged": false,"readOnlyRootFilesystem": false,"runAsNonRoot": true},"volumeMounts": [{"mountPath": "/cc-home","name": "cc-home-mount"}]}],"restartPolicy": "OnFailure","securityContext": {"runAsNonRoot": true,"runAsUser": 1000320999},"serviceAccount": "cpd-editor-sa","serviceAccountName": "cpd-editor-sa","volumes": [{"name": "cc-home-mount","persistentVolumeClaim": {"claimName": "cc-home-pvc"}}]}}}}'
run patched-cleanup-job-r36 --image {{ .DockerRegistryPrefix }}/environments-init-job:runtime-addon-r36-2.5.0.0-patch-3 --replicas 1 --restart OnFailure --overrides '{"spec": {"template": {"spec": {"affinity": {"nodeAffinity": {"requiredDuringSchedulingIgnoredDuringExecution": {"nodeSelectorTerms": [{"matchExpressions": [{"key": "beta.kubernetes.io/arch","operator": "In","values": ["amd64"]}]}]}}},"containers": [{"command": ["/bin/bash", "-c", "/home/node/scripts/initializeNotebooks.sh --checkJobandCleanup=true"],"image": "{{.DockerRegistryPrefix }}/environments-init-job:runtime-addon-r36-2.5.0.0-patch-3","env": [{"name": "MONITORED_JOBS","value": "prepull-r36-patched-image-job patched-copycm-job-r36 patched-copyscripts-job-r36 patched-cleanup-job-r36"}],"imagePullPolicy": "Always","name": "patched-init-job-container","resources": {"limits": {"cpu": "200m","memory": "64Mi"},"requests": {"cpu": "100m","memory": "32Mi"}},"securityContext": {"allowPrivilegeEscalation": false,"capabilities": {"drop": ["ALL"]},"privileged": false,"readOnlyRootFilesystem": false,"runAsNonRoot": true}}],"restartPolicy": "OnFailure","securityContext": {"runAsNonRoot": true,"runAsUser": 1000320999},"serviceAccount": "cpd-editor-sa","serviceAccountName": "cpd-editor-sa"}}}}'
