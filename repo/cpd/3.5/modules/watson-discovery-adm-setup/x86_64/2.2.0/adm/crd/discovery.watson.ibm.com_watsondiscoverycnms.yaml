apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  name: watsondiscoverycnms.discovery.watson.ibm.com
spec:
  additionalPrinterColumns:
  - JSONPath: .spec.version
    description: Version of the resource
    name: Version
    type: string
  - JSONPath: .status.conditions[?(@.type=="Ready")].status
    description: Condition ready
    name: Ready
    type: string
  - JSONPath: .status.conditions[?(@.type=="Ready")].reason
    description: Condition ready reason
    name: ReadyReason
    type: string
  - JSONPath: .status.conditions[?(@.type=="Updating")].status
    description: Condition updating
    name: Updating
    type: string
  - JSONPath: .status.conditions[?(@.type=="Updating")].reason
    description: Condition updating reason
    name: UpdatingReason
    type: string
  - JSONPath: .status.componentStatus.deployed
    description: Number of deployed components
    name: Deployed
    type: string
  - JSONPath: .status.componentStatus.verified
    description: Number of verified components
    name: Verified
    type: string
  - JSONPath: .status.customResourceQuiesce
    description: Quiesce status
    name: Quiesce
    type: string
  - JSONPath: .metadata.creationTimestamp
    description: Age of the resource
    name: Age
    type: date
  group: discovery.watson.ibm.com
  names:
    kind: WatsonDiscoveryCNM
    listKind: WatsonDiscoveryCNMList
    plural: watsondiscoverycnms
    singular: watsondiscoverycnm
  scope: Namespaced
  subresources:
    status: {}
  validation:
    openAPIV3Schema:
      description: WatsonDiscoveryCNM is the Schema for the watsondiscoverycnms API
      properties:
        apiVersion:
          description: 'APIVersion defines the versioned schema of this representation of an object.
            Servers should convert recognized schemas to the latest internal value, and may reject
            unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
          type: string
        appConfigOverrides:
          description: The key-value specified here override app config
          type: object
        kind:
          description: 'Kind is a string value representing the REST resource this object represents.
            Servers may infer this from the endpoint the client submits requests to. Cannot be
            updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
          type: string
        metadata:
          type: object
        spec:
          description: Spec defines the desired state of WatsonDiscoveryCNM
          properties:
            cnm:
              properties:
                apiServer:
                  properties:
                    database:
                      properties:
                        name:
                          type: string
                      type: object
                    httpClient:
                      properties:
                        connectTimeoutSec:
                          type: integer
                        keepAliveDurationSec:
                          type: integer
                        maxIdleConnections:
                          type: integer
                        readTimeoutSec:
                          type: integer
                        writeTimeoutSec:
                          type: integer
                      type: object
                    image:
                      description: Image for cnm-api
                      properties:
                        name:
                          description: Image name for cnm-api
                          type: string
                        tag:
                          description: Imange tag for cnm-api
                          type: string
                      type: object
                    livenessProbe:
                      properties:
                        failureThreshold:
                          type: integer
                        initialDelaySeconds:
                          type: integer
                        periodSeconds:
                          type: integer
                        timeoutSeconds:
                          type: integer
                      type: object
                    logLevel:
                      type: string
                    ports:
                      properties:
                        server:
                          properties:
                            containerPort:
                              type: integer
                            protocol:
                              type: string
                            servicePort:
                              type: integer
                          type: object
                      type: object
                    readinessProbe:
                      properties:
                        failureThreshold:
                          type: integer
                        initialDelaySeconds:
                          type: integer
                        periodSeconds:
                          type: integer
                        timeoutSeconds:
                          type: integer
                      type: object
                    replicas:
                      type: integer
                    resources:
                      description: cnm-api container resource requirements
                      properties:
                        limits:
                          properties:
                            cpu:
                              type: string
                            memory:
                              type: string
                          type: object
                        requests:
                          properties:
                            cpu:
                              type: string
                            memory:
                              type: string
                          type: object
                      type: object
                    s3Client:
                      properties:
                        connectionTimeoutMsec:
                          type: integer
                        socketTimeoutMsec:
                          type: integer
                      type: object
                  type: object
                create:
                  type: boolean
                db:
                  properties:
                    create:
                      properties:
                        activeDeadlineSeconds:
                          type: integer
                        hookWeight:
                          type: string
                      type: object
                    init:
                      properties:
                        activeDeadlineSeconds:
                          type: integer
                        hookWeight:
                          type: string
                        image:
                          properties:
                            name:
                              type: string
                            tag:
                              type: string
                          type: object
                        resources:
                          properties:
                            limits:
                              properties:
                                cpu:
                                  type: string
                                memory:
                                  type: string
                              type: object
                            requests:
                              properties:
                                cpu:
                                  type: string
                                memory:
                                  type: string
                              type: object
                          type: object
                      type: object
                  type: object
                glimpse:
                  properties:
                    appLog:
                      properties:
                        fluentdContainerTpl:
                          type: string
                      type: object
                    builder:
                      properties:
                        documentsReductionFactor:
                          type: string
                        grpcClient:
                          properties:
                            mmeshTargetNameOverride:
                              type: string
                          type: object
                        image:
                          properties:
                            name:
                              type: string
                            tag:
                              type: string
                          type: object
                        imagePullSecrets:
                          type: string
                        livenessProbe:
                          properties:
                            failureThreshold:
                              type: integer
                            initialDelaySeconds:
                              type: integer
                            periodSeconds:
                              type: integer
                            successThreshold:
                              type: integer
                            timeoutSeconds:
                              type: integer
                          type: object
                        port:
                          type: integer
                        readinessProbe:
                          properties:
                            failureThreshold:
                              type: integer
                            initialDelaySeconds:
                              type: integer
                            periodSeconds:
                              type: integer
                            successThreshold:
                              type: integer
                            timeoutSeconds:
                              type: integer
                          type: object
                        replicas:
                          type: integer
                        resources:
                          description: GlimpseBuilder container resource requirements
                          properties:
                            limits:
                              properties:
                                cpu:
                                  type: string
                                memory:
                                  type: string
                              type: object
                            requests:
                              properties:
                                cpu:
                                  type: string
                                memory:
                                  type: string
                              type: object
                          type: object
                        server:
                          properties:
                            threads:
                              type: integer
                            workers:
                              type: integer
                          type: object
                      type: object
                    create:
                      type: boolean
                    creds:
                      properties:
                        etcd:
                          properties:
                            connSecret:
                              type: string
                            fieldConnString:
                              type: string
                          type: object
                        tls:
                          properties:
                            fieldCert:
                              type: string
                            fieldServerCertificate:
                              type: string
                            fieldServerKey:
                              type: string
                            secret:
                              type: string
                          type: object
                      type: object
                    query:
                      properties:
                        etcdHealthCheck:
                          properties:
                            create:
                              type: boolean
                          type: object
                        glimpse:
                          properties:
                            defaultModelSize:
                              type: integer
                            image:
                              properties:
                                name:
                                  type: string
                                tag:
                                  type: string
                              type: object
                            livenessProbe:
                              properties:
                                failureThreshold:
                                  type: integer
                                initialDelaySeconds:
                                  type: integer
                                periodSeconds:
                                  type: integer
                                successThreshold:
                                  type: integer
                                timeoutSeconds:
                                  type: integer
                              type: object
                            modelLoadingConcurrency:
                              type: integer
                            modelLoadingTimeout:
                              type: integer
                            readinessProbe:
                              properties:
                                failureThreshold:
                                  type: integer
                                initialDelaySeconds:
                                  type: integer
                                periodSeconds:
                                  type: integer
                                successThreshold:
                                  type: integer
                                timeoutSeconds:
                                  type: integer
                              type: object
                            resources:
                              properties:
                                limits:
                                  properties:
                                    cpu:
                                      type: string
                                    memory:
                                      type: string
                                  type: object
                                requests:
                                  properties:
                                    cpu:
                                      type: string
                                    memory:
                                      type: string
                                  type: object
                              type: object
                          type: object
                        image:
                          properties:
                            name:
                              type: string
                            tag:
                              type: string
                          type: object
                        imagePullSecrets:
                          type: string
                        modelmesh:
                          properties:
                            image:
                              properties:
                                name:
                                  type: string
                                tag:
                                  type: string
                              type: object
                            resources:
                              properties:
                                limits:
                                  properties:
                                    cpu:
                                      type: string
                                    memory:
                                      type: string
                                  type: object
                                requests:
                                  properties:
                                    cpu:
                                      type: string
                                    memory:
                                      type: string
                                  type: object
                              type: object
                          type: object
                        ports:
                          properties:
                            grpc:
                              type: integer
                            thrift:
                              type: integer
                          type: object
                        replicas:
                          type: integer
                        resources:
                          description: GlimpseQuery container resource requirements
                          properties:
                            limits:
                              properties:
                                cpu:
                                  type: string
                                memory:
                                  type: string
                              type: object
                            requests:
                              properties:
                                cpu:
                                  type: string
                                memory:
                                  type: string
                              type: object
                          type: object
                      type: object
                    s3:
                      properties:
                        authSecret:
                          type: string
                        bucket:
                          type: string
                        endpoint:
                          type: string
                        endpointSecret:
                          properties:
                            fieldEndpoint:
                              type: string
                            name:
                              type: string
                          type: object
                        fieldAccessKey:
                          type: string
                        fieldSecretKey:
                          type: string
                        iam:
                          properties:
                            authSecret:
                              type: string
                            fieldApiKey:
                              type: string
                          type: object
                      type: object
                    streamLogToFile:
                      type: boolean
                  type: object
                keystoreGen:
                  properties:
                    image:
                      properties:
                        name:
                          type: string
                        tag:
                          type: string
                      type: object
                    resources:
                      properties:
                        limits:
                          properties:
                            cpu:
                              type: string
                            memory:
                              type: string
                          type: object
                        requests:
                          properties:
                            cpu:
                              type: string
                            memory:
                              type: string
                          type: object
                      type: object
                  type: object
                minio:
                  properties:
                    bucket:
                      type: string
                    bucketDocExport:
                      type: string
                  type: object
                quiesce:
                  properties:
                    enabled:
                      description: Set true when start quiesce of cnm component otherwise false
                      type: boolean
                  type: object
                seer:
                  properties:
                    create:
                      type: boolean
                    image:
                      properties:
                        name:
                          type: string
                        tag:
                          type: string
                      type: object
                    livenessProbe:
                      properties:
                        failureThreshold:
                          type: integer
                        initialDelaySeconds:
                          type: integer
                        periodSeconds:
                          type: integer
                        timeoutSeconds:
                          type: integer
                      type: object
                    ports:
                      properties:
                        server:
                          properties:
                            containerPort:
                              type: integer
                            protocol:
                              type: string
                            servicePort:
                              type: integer
                          type: object
                      type: object
                    readinessProbe:
                      properties:
                        failureThreshold:
                          type: integer
                        initialDelaySeconds:
                          type: integer
                        periodSeconds:
                          type: integer
                        timeoutSeconds:
                          type: integer
                      type: object
                    replicas:
                      type: integer
                    resources:
                      description: seer container resource requirements
                      properties:
                        limits:
                          properties:
                            cpu:
                              type: string
                            memory:
                              type: string
                          type: object
                        requests:
                          properties:
                            cpu:
                              type: string
                            memory:
                              type: string
                          type: object
                      type: object
                  type: object
                test:
                  properties:
                    image:
                      properties:
                        name:
                          type: string
                        tag:
                          type: string
                      type: object
                    resources:
                      properties:
                        limits:
                          properties:
                            cpu:
                              type: string
                            memory:
                              type: string
                          type: object
                        requests:
                          properties:
                            cpu:
                              type: string
                            memory:
                              type: string
                          type: object
                      type: object
                  type: object
              type: object
            shared:
              description: Global configuration shared across sub-systems of Watson Discovery
              properties:
                admin:
                  properties:
                    tls:
                      type: string
                  type: object
                contentIntelligence:
                  description: The description for content intelligence
                  properties:
                    enabled:
                      type: boolean
                  type: object
                database:
                  properties:
                    pg:
                      properties:
                        initJob:
                          properties:
                            activeDeadlineSeconds:
                              type: integer
                            backoffLimit:
                              type: integer
                          type: object
                        initializeWithLiquibase:
                          type: boolean
                        name:
                          type: string
                      type: object
                  type: object
                deploymentType:
                  description: DeploymentType controls replicas for Watson Discovery resources.
                    Development consumes minimum resource usage. Production supports high availability.
                  type: string
                dockerRegistryPrefix:
                  description: The prefix of docker registry where Watson Discovery containers
                    are located
                  type: string
                elastic:
                  properties:
                    configmap:
                      type: string
                    secret:
                      type: string
                  type: object
                imagePullSecret:
                  description: The secret name storing docker registry pull secret.
                  type: string
                initContainer:
                  properties:
                    etcd:
                      properties:
                        etcdTimeoutSeconds:
                          type: integer
                      type: object
                    postgres:
                      properties:
                        image:
                          properties:
                            name:
                              type: string
                            tag:
                              type: string
                          type: object
                        resources:
                          properties:
                            limits:
                              properties:
                                cpu:
                                  type: string
                                memory:
                                  type: string
                              type: object
                            requests:
                              properties:
                                cpu:
                                  type: string
                                memory:
                                  type: string
                              type: object
                          type: object
                      type: object
                    utils:
                      description: Init container configurations for common utility container
                      properties:
                        image:
                          properties:
                            name:
                              type: string
                            tag:
                              type: string
                          type: object
                        resources:
                          properties:
                            limits:
                              properties:
                                cpu:
                                  type: string
                                memory:
                                  type: string
                              type: object
                            requests:
                              properties:
                                cpu:
                                  type: string
                                memory:
                                  type: string
                              type: object
                          type: object
                      type: object
                    watsonNlp:
                      properties:
                        image:
                          properties:
                            name:
                              type: string
                            tag:
                              type: string
                          type: object
                        resources:
                          properties:
                            limits:
                              properties:
                                cpu:
                                  type: string
                                memory:
                                  type: string
                              type: object
                            requests:
                              properties:
                                cpu:
                                  type: string
                                memory:
                                  type: string
                              type: object
                          type: object
                      type: object
                  type: object
                metering:
                  description: Metering annotations.
                  properties:
                    cloudpakId:
                      description: The ID of IBM Cloud Pak
                      type: string
                    cloudpakInstanceId:
                      description: The instance ID of IBM Cloud Pak
                      type: string
                    cloudpakName:
                      description: The name of IBM Cloud Pak
                      type: string
                    productChargedContainers:
                      description: The charged containers of product.
                      type: string
                    productCloudpakRatio:
                      description: The ratio of cloudpak.
                      type: string
                    productId:
                      description: The ID of this a product.
                      type: string
                    productMetric:
                      description: The type of product metrics.
                      type: string
                    productName:
                      description: The name of this a product.
                      type: string
                    productVersion:
                      description: The version of a product.
                      type: string
                  type: object
                metricsCollection:
                  properties:
                    enabled:
                      type: boolean
                  type: object
                modelTrain:
                  properties:
                    serviceUrl:
                      type: string
                  type: object
                mtdata:
                  properties:
                    enabled:
                      type: boolean
                  type: object
                privilegedServiceAccount:
                  description: The privileged service account used in the pods performing administration
                    tasks
                  type: string
                quiesce:
                  properties:
                    enabled:
                      description: Set true when quiesce all components otherwise false
                      type: boolean
                  type: object
                serviceAccount:
                  description: The service account used in Watson Discovery pods
                  type: string
                statsd:
                  properties:
                    exporterPrometheusPort:
                      type: number
                    image:
                      properties:
                        name:
                          type: string
                        tag:
                          type: string
                      type: object
                    resources:
                      properties:
                        limits:
                          properties:
                            cpu:
                              type: string
                            memory:
                              type: string
                          type: object
                        requests:
                          properties:
                            cpu:
                              type: string
                            memory:
                              type: string
                          type: object
                      type: object
                  type: object
                storageClassName:
                  description: The storage class name for the persistent volumes used in Watson
                    Discovery
                  type: string
              required:
              - dockerRegistryPrefix
              - storageClassName
              type: object
            version:
              description: The version of Watson Discovery to be deployed.
              type: string
          type: object
        status:
          description: Status defines the observed state of WatsonDiscoveryCNM
          type: object
      type: object
  versions:
  - name: v1
    served: true
    storage: true
