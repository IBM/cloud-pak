patch cm runtime-addon-py36 -p '{"data": {"jupyter-py36-server.json": "{\"displayName\":\"Jupyter with Python 3.6\",\"description\":\"Jupyter Notebook Server with Python 3.6\",\"annotations\":[{\"name\":\"cloudpakName\",\"value\":\"IBM Cloud Pak for Data\"},{\"name\":\"productID\",\"value\":\"ICP4D-Watson-Studio-3-0-1\"},{\"name\":\"cloudpakId\",\"value\":\"eb9998dcc5d24e3eb5b6fb488f750fe2\"},{\"name\":\"cloudpakVersion\",\"value\":\"3.0.1\"},{\"name\":\"productMetric\",\"value\":\"VIRTUAL_PROCESSOR_CORE\"},{\"name\":\"productChargedContainers\",\"value\":\"All\"},{\"name\":\"productID\",\"value\":\"ICP4D-Watson-Studio-3-0-1\"},{\"name\":\"productName\",\"value\":\"IBM Watson Studio Services for IBM Cloud Pak for Data\"},{\"name\":\"productVersion\",\"value\":\"3.0.1\"}],\"author\":\"IBM\",\"tested\":true,\"isService\":true,\"features\":[\"environment\",\"python\",\"worker\"],\"runtimeType\":\"jupyter-py36\",\"portMappings\":[{\"servicePort\":8888,\"containerPort\":8888,\"protocol\":\"TCP\"},{\"servicePort\":8889,\"containerPort\":8889,\"protocol\":\"TCP\"}],\"replicas\":1,\"image\":\"{{.DockerRegistryPrefix}}/wslocal-x86-runtime-py36ce162:cpd301-master-1132\",\"command\":[\"/usr/sbin/tini\",\"--\",\"/opt/ibm/ws/bin/setup_container.sh\"],\"env\":[{\"name\":\"APP_ENV_KG_CONNECT_TIMOUT\",\"value\":\"600\"},{\"name\":\"APP_ENV_KG_REQUEST_TIMOUT\",\"value\":\"600\"}],\"volumes\":[{\"volume\":\"scripts\",\"mountPath\":\"/cc-home/.scripts\",\"subPath\":\".scripts\",\"readOnly\":true,\"claimName\":\"cc-home-pvc\"},{\"volume\":\"dbdrivers\",\"mountPath\":\"/user-home/_global_/dbdrivers\",\"subPath\":\"_global_/dbdrivers\",\"readOnly\":true,\"claimName\":\"user-home-pvc\"},{\"volume\":\"wmllibpy3\",\"mountPath\":\"/cc-home/_global_/python-3\",\"subPath\":\"_global_/python-3\",\"readOnly\":true,\"claimName\":\"cc-home-pvc\"},{\"volume\":\"wmllibpy36\",\"mountPath\":\"/cc-home/_global_/python-3.6\",\"subPath\":\"_global_/python-3\",\"readOnly\":true,\"claimName\":\"cc-home-pvc\"},{\"volume\":\"wmllib2py3\",\"mountPath\":\"/user-home/_global_/python-3\",\"subPath\":\"_global_/python-3\",\"readOnly\":true,\"claimName\":\"user-home-pvc\"},{\"volume\":\"wmllib2py36\",\"mountPath\":\"/user-home/_global_/python-3.6\",\"subPath\":\"_global_/python-3.6\",\"readOnly\":true,\"claimName\":\"user-home-pvc\"},{\"volume\":\"truststores\",\"mountPath\":\"/cc-home/_global_/security/customer-truststores\",\"subPath\":\"_global_/security/customer-truststores\",\"readOnly\":true,\"claimName\":\"cc-home-pvc\"},{\"volume\":\"truststores2\",\"mountPath\":\"/user-home/_global_/security/customer-truststores\",\"subPath\":\"_global_/security/customer-truststores\",\"readOnly\":true,\"claimName\":\"user-home-pvc\"},{\"volume\":\"remoteimages\",\"mountPath\":\"/cc-home/_global_/.remote-images\",\"subPath\":\"_global_/.remote-images\",\"readOnly\":true,\"claimName\":\"cc-home-pvc\"},{\"volume\":\"project_dir\",\"mountPath\":\"/project_data/data_asset\",\"claimName\":\"file-api-claim\",\"subPath\":\"projects/$project_id/assets/data_asset\"},{\"volume\":\"notebookscript\",\"mountPath\":\"/opt/ibm/ws\",\"claimName\":\"cc-home-pvc\",\"readOnly\":true,\"subPath\":\"_global_/config/.notebookscripts/active_scripts\"},{\"volume\":\"user-home-conda\",\"mountPath\":\"/user-home/_global_/config/conda\",\"claimName\":\"user-home-pvc\",\"readOnly\":true,\"subPath\":\"_global_/config/conda\"},{\"volume\":\"cc-home-conda\",\"mountPath\":\"/cc-home/_global_/config/conda\",\"claimName\":\"cc-home-pvc\",\"readOnly\":true,\"subPath\":\"_global_/config/conda\"}],\"probes\":{\"liveness\":{\"path\":\"/api/monitor\",\"scheme\":\"https\",\"port\":8889,\"initialDelaySeconds\":120,\"timeoutSeconds\":20,\"periodSeconds\":60,\"failureThreshold\":6},\"readiness\":{\"path\":\"/api/monitor\",\"scheme\":\"https\",\"port\":8889,\"initialDelaySeconds\":15,\"timeoutSeconds\":10,\"periodSeconds\":10}},\"resources\":{\"cpu\":{\"request\":1000,\"minimum\":1000},\"gpu\":{\"request\":-1,\"minimum\":0},\"memory\":{\"request\":1024,\"minimum\":1024},\"duration\":{\"value\":-1,\"units\":\"unix\"}}}\n"}}'
patch cm runtime-addon-py36 -p '{"data": {"jupyter-lab-server.json": "{\"displayName\":\"Jupyterlab Notebook IDE with Python 3.6\",\"description\":\"Jupyterlab Notebook IDE\",\"annotations\":[{\"name\":\"cloudpakName\",\"value\":\"IBM Cloud Pak for Data\"},{\"name\":\"cloudpakId\",\"value\":\"eb9998dcc5d24e3eb5b6fb488f750fe2\"},{\"name\":\"cloudpakVersion\",\"value\":\"3.0.1\"},{\"name\":\"productMetric\",\"value\":\"VIRTUAL_PROCESSOR_CORE\"},{\"name\":\"productChargedContainers\",\"value\":\"All\"},{\"name\":\"productID\",\"value\":\"ICP4D-Watson-Studio-3-0-1\"},{\"name\":\"productName\",\"value\":\"IBM Watson Studio Services for IBM Cloud Pak for Data\"},{\"name\":\"productVersion\",\"value\":\"3.0.1\"}],\"author\":\"IBM\",\"tested\":true,\"isService\":true,\"features\":[\"environment\",\"python\"],\"runtimeType\":\"jupyter-lab\",\"portMappings\":[{\"servicePort\":8888,\"containerPort\":8888,\"protocol\":\"TCP\"},{\"servicePort\":8889,\"containerPort\":8889,\"protocol\":\"TCP\"}],\"replicas\":1,\"image\":\"{{.DockerRegistryPrefix}}/wslocal-x86-runtime-py36ce162:cpd301-master-1132\",\"command\":[\"/usr/sbin/tini\",\"--\",\"/opt/ibm/ws/bin/setup_container.sh\"],\"volumes\":[{\"volume\":\"dbdrivers\",\"mountPath\":\"/user-home/_global_/dbdrivers\",\"subPath\":\"_global_/dbdrivers\",\"readOnly\":true,\"claimName\":\"user-home-pvc\"},{\"volume\":\"wmllibpy3\",\"mountPath\":\"/cc-home/_global_/python-3\",\"subPath\":\"_global_/python-3\",\"readOnly\":true,\"claimName\":\"cc-home-pvc\"},{\"volume\":\"wmllibpy36\",\"mountPath\":\"/cc-home/_global_/python-3.6\",\"subPath\":\"_global_/python-3\",\"readOnly\":true,\"claimName\":\"cc-home-pvc\"},{\"volume\":\"wmllib2py3\",\"mountPath\":\"/user-home/_global_/python-3\",\"subPath\":\"_global_/python-3\",\"readOnly\":true,\"claimName\":\"user-home-pvc\"},{\"volume\":\"wmllib2py36\",\"mountPath\":\"/user-home/_global_/python-3.6\",\"subPath\":\"_global_/python-3.6\",\"readOnly\":true,\"claimName\":\"user-home-pvc\"},{\"volume\":\"truststores\",\"mountPath\":\"/cc-home/_global_/security/customer-truststores\",\"subPath\":\"_global_/security/customer-truststores\",\"readOnly\":true,\"claimName\":\"cc-home-pvc\"},{\"volume\":\"truststores2\",\"mountPath\":\"/user-home/_global_/security/customer-truststores\",\"subPath\":\"_global_/security/customer-truststores\",\"readOnly\":true,\"claimName\":\"user-home-pvc\"},{\"volume\":\"project_dir\",\"mountPath\":\"/project_data/data_asset\",\"claimName\":\"file-api-claim\",\"subPath\":\"projects/$project_id/assets/data_asset\"},{\"volume\":\"jupyterlab_dir\",\"mountPath\":\"/home/wsuser\",\"claimName\":\"file-api-claim\",\"subPath\":\"projects/$project_id/jupyterlab/$user_id\"},{\"volume\":\"notebookscript\",\"mountPath\":\"/opt/ibm/ws\",\"claimName\":\"cc-home-pvc\",\"readOnly\":true,\"subPath\":\"_global_/config/.notebookscripts/active_scripts\"},{\"volume\":\"user-home-conda\",\"mountPath\":\"/user-home/_global_/config/conda\",\"claimName\":\"user-home-pvc\",\"readOnly\":true,\"subPath\":\"_global_/config/conda\"},{\"volume\":\"cc-home-conda\",\"mountPath\":\"/cc-home/_global_/config/conda\",\"claimName\":\"cc-home-pvc\",\"readOnly\":true,\"subPath\":\"_global_/config/conda\"}],\"probes\":{\"liveness\":{\"path\":\"/api/monitor\",\"scheme\":\"https\",\"port\":8889,\"initialDelaySeconds\":120,\"timeoutSeconds\":20,\"periodSeconds\":60,\"failureThreshold\":6},\"readiness\":{\"path\":\"/api/monitor\",\"scheme\":\"https\",\"port\":8889,\"initialDelaySeconds\":15,\"timeoutSeconds\":10,\"periodSeconds\":10}},\"resources\":{\"cpu\":{\"request\":1000,\"minimum\":1000},\"gpu\":{\"request\":-1,\"minimum\":0},\"memory\":{\"request\":1024,\"minimum\":1024},\"duration\":{\"value\":-1,\"units\":\"unix\"}}}\n"}}'
patch cm runtime-addon-py36 -p '{"metadata": { "labels": {"icpdata_addon_version": "3.0.1_216"}}}'
create cm patch-runtime-addon-py36 --from-literal=module=runtime-addon-py36
patch cm patch-runtime-addon-py36 -p '{"data": {"patch-runtime-addon-py36-copy-scripts-job.json": "{\"kind\":\"Job\",\"apiVersion\":\"batch/v1\",\"metadata\":{\"name\":\"patch-runtime-addon-py36-copyscript\",\"annotations\":{\"cloudpakName\":\"IBM Cloud Pak for Data\",\"cloudpakId\":\"eb9998dcc5d24e3eb5b6fb488f750fe2\",\"cloudpakVersion\":\"3.0.1\",\"productMetric\":\"VIRTUAL_PROCESSOR_CORE\",\"productChargedContainers\":\"All\",\"productID\":\"ICP4D-Watson-Studio-3-0-1\",\"productName\":\"IBM Watson Studio Services for IBM Cloud Pak for Data\",\"productVersion\":\"3.0.1\"}},\"spec\":{\"template\":{\"spec\":{\"affinity\":{\"nodeAffinity\":{\"requiredDuringSchedulingIgnoredDuringExecution\":{\"nodeSelectorTerms\":[{\"matchExpressions\":[{\"key\":\"beta.kubernetes.io/arch\",\"operator\":\"In\",\"values\":[\"amd64\",\"ppc64le\"]}]}]}}},\"containers\":[{\"command\":[\"/bin/bash\",\"-c\",\"/home/node/scripts/initializeNotebooks.sh --copyscripts=true\"],\"image\":\"{{.DockerRegistryPrefix}}/environments-init-job:3.0.1_218.1320-amd64\",\"env\":[{\"name\":\"APP_ENV_SCRIPTS_VERSION\",\"value\":\"1320\"}],\"imagePullPolicy\":\"Always\",\"name\":\"patched-init-job-container\",\"resources\":{\"limits\":{\"cpu\":\"500m\",\"memory\":\"256Mi\"},\"requests\":{\"cpu\":\"250m\",\"memory\":\"128Mi\"}},\"securityContext\":{\"allowPrivilegeEscalation\":false,\"capabilities\":{\"drop\":[\"ALL\"]},\"privileged\":false,\"readOnlyRootFilesystem\":false,\"runAsNonRoot\":true},\"volumeMounts\":[{\"mountPath\":\"/cc-home\",\"name\":\"cc-home-mount\"}]}],\"restartPolicy\":\"OnFailure\",\"securityContext\":{\"runAsNonRoot\":true,\"runAsUser\":1000320999},\"serviceAccount\":\"cpd-editor-sa\",\"serviceAccountName\":\"cpd-editor-sa\",\"volumes\":[{\"name\":\"cc-home-mount\",\"persistentVolumeClaim\":{\"claimName\":\"cc-home-pvc\"}}]}}}}"}}'
patch cm patch-runtime-addon-py36 -p '{"data": {"patch-runtime-addon-py36-prepull-job.json": "{\"kind\":\"Job\",\"apiVersion\":\"batch/v1\",\"metadata\":{\"labels\":{\"app\":\"patch-runtime-addon-py36\",\"component\":\"patch-runtime-addon-py36\",\"run\":\"patch-runtime-addon-py36\"},\"name\":\"patch-runtime-addon-py36\",\"annotations\":{\"cloudpakName\":\"IBM Cloud Pak for Data\",\"cloudpakId\":\"eb9998dcc5d24e3eb5b6fb488f750fe2\",\"cloudpakVersion\":\"3.0.1\",\"productMetric\":\"VIRTUAL_PROCESSOR_CORE\",\"productChargedContainers\":\"All\",\"productID\":\"ICP4D-Watson-Studio-3-0-1\",\"productName\":\"IBM Watson Studio Services for IBM Cloud Pak for Data\",\"productVersion\":\"3.0.1\",\"helm.sh/hook\":\"pre-install,pre-upgrade\",\"helm.sh/hook-delete-policy\":\"hook-succeeded\"}},\"spec\":{\"parallelism\":50,\"completions\":50,\"template\":{\"metadata\":{\"labels\":{\"app\":\"patch-runtime-addon-py36\",\"component\":\"patch-runtime-addon-py36\",\"run\":\"patch-runtime-addon-py36\"},\"annotations\":{\"cloudpakName\":\"IBM Cloud Pak for Data\",\"cloudpakId\":\"eb9998dcc5d24e3eb5b6fb488f750fe2\",\"cloudpakVersion\":\"3.0.1\",\"productMetric\":\"VIRTUAL_PROCESSOR_CORE\",\"productChargedContainers\":\"All\",\"productID\":\"ICP4D-Watson-Studio-3-0-1\",\"productName\":\"IBM Watson Studio Services for IBM Cloud Pak for Data\",\"productVersion\":\"3.0.1\"}},\"spec\":{\"affinity\":{\"nodeAffinity\":{\"requiredDuringSchedulingIgnoredDuringExecution\":{\"nodeSelectorTerms\":[{\"matchExpressions\":[{\"key\":\"beta.kubernetes.io/arch\",\"operator\":\"In\",\"values\":[\"amd64\", \"ppc64le\"]}]}]}},\"podAntiAffinity\":{\"requiredDuringSchedulingIgnoredDuringExecution\":[{\"labelSelector\":{\"matchExpressions\":[{\"key\":\"run\",\"operator\":\"In\",\"values\":[\"patch-runtime-addon-py36\"]}]},\"topologyKey\":\"kubernetes.io/hostname\"}]}},\"serviceAccountName\":\"cpd-viewer-sa\",\"automountServiceAccountToken\":false,\"hostNetwork\":false,\"hostPID\":false,\"hostIPC\":false,\"securityContext\":{\"runAsUser\":1000320999,\"runAsNonRoot\":true},\"containers\":[{\"name\":\"patch-runtime-addon-py36-container\",\"image\":\"{{.DockerRegistryPrefix}}/wslocal-x86-runtime-py36ce162:cpd301-master-1132\",\"imagePullPolicy\":\"IfNotPresent\",\"command\":[\"echo\",\"Image {{.DockerRegistryPrefix}}/IMAGE preloaded\"],\"securityContext\":{\"privileged\":false,\"allowPrivilegeEscalation\":false,\"readOnlyRootFilesystem\":true,\"runAsNonRoot\":true,\"capabilities\":{\"drop\":[\"ALL\"]}},\"resources\":{\"limits\":{\"cpu\":\"500m\",\"memory\":\"512Mi\"},\"requests\":{\"cpu\":\"100m\",\"memory\":\"128Mi\"}}}],\"restartPolicy\":\"OnFailure\"}}}}"}}'
run patch-runtime-addon-py36-job --generator run-pod/v1 --image {{.DockerRegistryPrefix}}/environments-init-job:3.0.1_218.1320-amd64 --replicas 1 --restart OnFailure --overrides '{"spec":{"affinity":{"nodeAffinity":{"requiredDuringSchedulingIgnoredDuringExecution":{"nodeSelectorTerms":[{"matchExpressions":[{"key":"beta.kubernetes.io/arch","operator":"In","values":["amd64"]}]}]}}},"containers":[{"command":["/bin/bash","-c","/home/node/scripts/initializeNotebooks.sh --executePatch"],"image":"{{.DockerRegistryPrefix}}/environments-init-job:3.0.1_218.1320-amd64","imagePullPolicy":"Always","name":"patched-init-job-container","resources":{"limits":{"cpu":"500m","memory":"256Mi"},"requests":{"cpu":"250m","memory":"128Mi"}},"securityContext":{"allowPrivilegeEscalation":false,"capabilities":{"drop":["ALL"]},"privileged":false,"readOnlyRootFilesystem":false,"runAsNonRoot":true}, "volumeMounts":[{"mountPath":"/home/node/patchscripts","name":"patch-cm"}]}],"restartPolicy":"OnFailure","securityContext":{"runAsNonRoot":true,"runAsUser":1000320999},"serviceAccount":"cpd-editor-sa","serviceAccountName":"cpd-editor-sa", "volumes":[{"name":"patch-cm","configMap":{"name":"patch-runtime-addon-py36"}}]}}'
