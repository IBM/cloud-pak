patch deployment ax-environments-api-deploy -p '{"spec": {"template": {"spec":{"containers": [{"name": "runtime", "image":"{{.DockerRegistryPrefix}}/environments:3.0.1_217-amd64"}]}}}}'
patch deployment ax-environments-ui-deploy -p '{"spec": {"template": {"spec":{"containers": [{"name": "runtime", "image":"{{.DockerRegistryPrefix}}/environments:3.0.1_217-amd64"}]}}}}'
create cm patch-environments --from-literal=module=environments
patch cm patch-environments -p '{"data": {"patch-environments-copy-scripts-job.json": "{\"kind\":\"Job\",\"apiVersion\":\"batch/v1\",\"metadata\":{\"name\":\"patch-environments-copyscript\",\"annotations\":{\"cloudpakName\":\"IBM Cloud Pak for Data\",\"cloudpakId\":\"eb9998dcc5d24e3eb5b6fb488f750fe2\",\"cloudpakVersion\":\"3.0.1\",\"productMetric\":\"VIRTUAL_PROCESSOR_CORE\",\"productChargedContainers\":\"All\",\"productID\":\"ICP4D-Watson-Studio-3-0-1\",\"productName\":\"IBM Watson Studio Services for IBM Cloud Pak for Data\",\"productVersion\":\"3.0.1\"}},\"spec\":{\"template\":{\"spec\":{\"affinity\":{\"nodeAffinity\":{\"requiredDuringSchedulingIgnoredDuringExecution\":{\"nodeSelectorTerms\":[{\"matchExpressions\":[{\"key\":\"beta.kubernetes.io/arch\",\"operator\":\"In\",\"values\":[\"amd64\",\"ppc64le\"]}]}]}}},\"containers\":[{\"command\":[\"/bin/bash\",\"-c\",\"/home/node/scripts/initializeNotebooks.sh --copyscripts=true\"],\"image\":\"{{.DockerRegistryPrefix}}/environments-init-job:3.0.1_218.1320-amd64\",\"env\":[{\"name\":\"APP_ENV_SCRIPTS_VERSION\",\"value\":\"1320\"}],\"imagePullPolicy\":\"Always\",\"name\":\"patched-init-job-container\",\"resources\":{\"limits\":{\"cpu\":\"500m\",\"memory\":\"256Mi\"},\"requests\":{\"cpu\":\"250m\",\"memory\":\"128Mi\"}},\"securityContext\":{\"allowPrivilegeEscalation\":false,\"capabilities\":{\"drop\":[\"ALL\"]},\"privileged\":false,\"readOnlyRootFilesystem\":false,\"runAsNonRoot\":true},\"volumeMounts\":[{\"mountPath\":\"/cc-home\",\"name\":\"cc-home-mount\"}]}],\"restartPolicy\":\"OnFailure\",\"securityContext\":{\"runAsNonRoot\":true,\"runAsUser\":1000320999},\"serviceAccount\":\"cpd-editor-sa\",\"serviceAccountName\":\"cpd-editor-sa\",\"volumes\":[{\"name\":\"cc-home-mount\",\"persistentVolumeClaim\":{\"claimName\":\"cc-home-pvc\"}}]}}}}"}}'
patch cm patch-environments -p '{"data": {"patch-environments-envspecsupdate-job.json": "{\"kind\":\"Job\",\"apiVersion\":\"batch/v1\",\"metadata\":{\"name\":\"patch-environments-update-envspecs\",\"annotations\":{\"cloudpakName\":\"IBM Cloud Pak for Data\",\"cloudpakId\":\"eb9998dcc5d24e3eb5b6fb488f750fe2\",\"cloudpakVersion\":\"3.0.1\",\"productMetric\":\"VIRTUAL_PROCESSOR_CORE\",\"productChargedContainers\":\"All\",\"productID\":\"ICP4D-Watson-Studio-3-0-1\",\"productName\":\"IBM Watson Studio Services for IBM Cloud Pak for Data\",\"productVersion\":\"3.0.1\"}},\"spec\":{\"template\":{\"spec\":{\"affinity\":{\"nodeAffinity\":{\"requiredDuringSchedulingIgnoredDuringExecution\":{\"nodeSelectorTerms\":[{\"matchExpressions\":[{\"key\":\"beta.kubernetes.io/arch\",\"operator\":\"In\",\"values\":[\"amd64\",\"ppc64le\"]}]}]}}},\"containers\":[{\"command\":[\"/bin/bash\",\"-c\",\"/home/node/scripts/initializeNotebooks.sh --updateEnvironmentSpecs\"],\"image\":\"{{.DockerRegistryPrefix}}/environments-init-job:3.0.1_218.1320-amd64\",\"imagePullPolicy\":\"Always\",\"name\":\"patched-init-job-container\",\"resources\":{\"limits\":{\"cpu\":\"500m\",\"memory\":\"256Mi\"},\"requests\":{\"cpu\":\"250m\",\"memory\":\"128Mi\"}},\"securityContext\":{\"allowPrivilegeEscalation\":false,\"capabilities\":{\"drop\":[\"ALL\"]},\"privileged\":false,\"readOnlyRootFilesystem\":false,\"runAsNonRoot\":true},\"volumeMounts\":[{\"mountPath\":\"/cc-home\",\"name\":\"cc-home-mount\"}]}],\"restartPolicy\":\"OnFailure\",\"securityContext\":{\"runAsNonRoot\":true,\"runAsUser\":1000320999},\"serviceAccount\":\"cpd-editor-sa\",\"serviceAccountName\":\"cpd-editor-sa\",\"volumes\":[{\"name\":\"cc-home-mount\",\"persistentVolumeClaim\":{\"claimName\":\"cc-home-pvc\"}}]}}}}"}}'
patch cm patch-environments -p '{"data": {"patch-environments-deletefile-job.json": "{\"kind\":\"Job\",\"apiVersion\":\"batch/v1\",\"metadata\":{\"name\":\"patch-environments-delete-files\",\"annotations\":{\"cloudpakName\":\"IBM Cloud Pak for Data\",\"cloudpakId\":\"eb9998dcc5d24e3eb5b6fb488f750fe2\",\"cloudpakVersion\":\"3.0.1\",\"productMetric\":\"VIRTUAL_PROCESSOR_CORE\",\"productChargedContainers\":\"All\",\"productID\":\"ICP4D-Watson-Studio-3-0-1\",\"productName\":\"IBM Watson Studio Services for IBM Cloud Pak for Data\",\"productVersion\":\"3.0.1\"}},\"spec\":{\"template\":{\"spec\":{\"affinity\":{\"nodeAffinity\":{\"requiredDuringSchedulingIgnoredDuringExecution\":{\"nodeSelectorTerms\":[{\"matchExpressions\":[{\"key\":\"beta.kubernetes.io/arch\",\"operator\":\"In\",\"values\":[\"amd64\",\"ppc64le\"]}]}]}}},\"containers\":[{\"command\":[\"/bin/bash\",\"-c\",\"/home/node/scripts/initializeNotebooks.sh --genericDeleteFiles\"],\"image\":\"{{.DockerRegistryPrefix}}/environments-init-job:3.0.1_218.1320-amd64\",\"env\":[{\"name\":\"FILES_TO_BE_DELETED\",\"value\":\"/cc-home/_global_/config/environments/software-specifications/spark23*\"}],\"imagePullPolicy\":\"Always\",\"name\":\"patched-init-job-container\",\"resources\":{\"limits\":{\"cpu\":\"500m\",\"memory\":\"256Mi\"},\"requests\":{\"cpu\":\"250m\",\"memory\":\"128Mi\"}},\"securityContext\":{\"allowPrivilegeEscalation\":false,\"capabilities\":{\"drop\":[\"ALL\"]},\"privileged\":false,\"readOnlyRootFilesystem\":false,\"runAsNonRoot\":true},\"volumeMounts\":[{\"mountPath\":\"/cc-home\",\"name\":\"cc-home-mount\"}]}],\"restartPolicy\":\"OnFailure\",\"securityContext\":{\"runAsNonRoot\":true,\"runAsUser\":1000320999},\"serviceAccount\":\"cpd-editor-sa\",\"serviceAccountName\":\"cpd-editor-sa\",\"volumes\":[{\"name\":\"cc-home-mount\",\"persistentVolumeClaim\":{\"claimName\":\"cc-home-pvc\"}}]}}}}"}}'
run patch-environments-job --generator run-pod/v1 --image {{.DockerRegistryPrefix}}/environments-init-job:3.0.1_218.1320-amd64 --replicas 1 --restart OnFailure --overrides '{"spec":{"affinity":{"nodeAffinity":{"requiredDuringSchedulingIgnoredDuringExecution":{"nodeSelectorTerms":[{"matchExpressions":[{"key":"beta.kubernetes.io/arch","operator":"In","values":["amd64"]}]}]}}},"containers":[{"command":["/bin/bash","-c","/home/node/scripts/initializeNotebooks.sh --executePatch"],"image":"{{.DockerRegistryPrefix}}/environments-init-job:3.0.1_218.1320-amd64","imagePullPolicy":"Always","name":"patched-init-job-container","resources":{"limits":{"cpu":"500m","memory":"256Mi"},"requests":{"cpu":"250m","memory":"128Mi"}},"securityContext":{"allowPrivilegeEscalation":false,"capabilities":{"drop":["ALL"]},"privileged":false,"readOnlyRootFilesystem":false,"runAsNonRoot":true}, "volumeMounts":[{"mountPath":"/home/node/patchscripts","name":"patch-cm"}]}],"restartPolicy":"OnFailure","securityContext":{"runAsNonRoot":true,"runAsUser":1000320999},"serviceAccount":"cpd-editor-sa","serviceAccountName":"cpd-editor-sa", "volumes":[{"name":"patch-cm","configMap":{"name":"patch-environments"}}]}}'





