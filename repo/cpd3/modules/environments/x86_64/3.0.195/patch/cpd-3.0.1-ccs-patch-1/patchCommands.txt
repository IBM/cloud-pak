patch deployment ax-environments-api-deploy -p '{"spec": {"template": {"spec":{"containers": [{"name": "runtime", "image":"{{.DockerRegistryPrefix }}/environments:3.0.1_204-amd64"}]}}}}'
run patched-deletefile-job-environments --image {{ .DockerRegistryPrefix }}/environments-init-job:3.0.1_204.1289-amd64 --replicas 1 --restart OnFailure --overrides '{"spec": {"template": {"spec": {"affinity": {"nodeAffinity": {"requiredDuringSchedulingIgnoredDuringExecution": {"nodeSelectorTerms": [{"matchExpressions": [{"key": "beta.kubernetes.io/arch","operator": "In","values": ["amd64"]}]}]}}},"containers": [{"command": ["/bin/bash", "-c", "/home/node/scripts/initializeNotebooks.sh --genericDeleteFiles"],"image": "{{.DockerRegistryPrefix }}/environments-init-job:3.0.1_204.1289-amd64","env": [{"name": "FILES_TO_BE_DELETED","value": "/cc-home/_global_/config/environments/software-specifications/spark23*"}],"imagePullPolicy": "Always","name": "patched-init-job-container","resources": {"limits": {"cpu": "200m","memory": "64Mi"},"requests": {"cpu": "100m","memory": "32Mi"}},"securityContext": {"allowPrivilegeEscalation": false,"capabilities": {"drop": ["ALL"]},"privileged": false,"readOnlyRootFilesystem": false,"runAsNonRoot": true},"volumeMounts": [{"mountPath": "/cc-home","name": "cc-home-mount"}]}],"restartPolicy": "OnFailure","securityContext": {"runAsNonRoot": true,"runAsUser": 1000320999},"serviceAccount": "cpd-editor-sa","serviceAccountName": "cpd-editor-sa","volumes": [{"name": "cc-home-mount","persistentVolumeClaim": {"claimName": "cc-home-pvc"}}]}}}}'
run patched-cleanup-job-environments --image {{ .DockerRegistryPrefix }}/environments-init-job:3.0.1_204.1289-amd64 --replicas 1 --restart OnFailure --overrides '{"spec": {"template": {"spec": {"affinity": {"nodeAffinity": {"requiredDuringSchedulingIgnoredDuringExecution": {"nodeSelectorTerms": [{"matchExpressions": [{"key": "beta.kubernetes.io/arch","operator": "In","values": ["amd64"]}]}]}}},"containers": [{"command": ["/bin/bash", "-c", "/home/node/scripts/initializeNotebooks.sh --checkJobandCleanup=true"],"image": "{{.DockerRegistryPrefix }}/environments-init-job:3.0.1_204.1289-amd64","env": [{"name": "MONITORED_JOBS","value": "patched-deletefile-job-environments patched-cleanup-job-environments"}],"imagePullPolicy": "Always","name": "patched-init-job-container","resources": {"limits": {"cpu": "200m","memory": "64Mi"},"requests": {"cpu": "100m","memory": "32Mi"}},"securityContext": {"allowPrivilegeEscalation": false,"capabilities": {"drop": ["ALL"]},"privileged": false,"readOnlyRootFilesystem": false,"runAsNonRoot": true}}],"restartPolicy": "OnFailure","securityContext": {"runAsNonRoot": true,"runAsUser": 1000320999},"serviceAccount": "cpd-editor-sa","serviceAccountName": "cpd-editor-sa"}}}}'
