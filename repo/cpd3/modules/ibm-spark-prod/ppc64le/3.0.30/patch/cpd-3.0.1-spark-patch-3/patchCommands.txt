run spark-hb-configmap-update-patch --image {{.DockerRegistryPrefix}}/spark-hb-truststore-util:3.0.30.4-ppc64le --restart OnFailure --generator=run-pod/v1 --overrides '{"apiVersion":"v1","kind":"Pod","metadata":{"name":"spark-hb-configmap-update-patch","labels":{"app":"spark-hb-configmap-update","run":"spark-hb-configmap-update"}},"spec":{"affinity":{"nodeAffinity":{"requiredDuringSchedulingIgnoredDuringExecution":{"nodeSelectorTerms":[{"matchExpressions":[{"key":"beta.kubernetes.io/arch","operator":"In","values":["ppc64le"]}]}]}},"podAntiAffinity":{"requiredDuringSchedulingIgnoredDuringExecution":[{"labelSelector":{"matchExpressions":[{"key":"run","operator":"In","values":["spark-hb-configmap-update"]}]},"topologyKey":"kubernetes.io/hostname"}]}},"containers":[{"args":["./tmp/spark-hb-configmap-update-patch.sh 2.4.6.v1.1-ppc64le {{.Namespace}}"],"command":["/bin/sh","-c"],"image":"{{ .DockerRegistryPrefix }}/spark-hb-truststore-util:3.0.30.4-ppc64le","imagePullPolicy":"Always","name":"spark-hb-configmap-update-container","resources":{},"securityContext":{"capabilities":{"drop":["KILL","MKNOD","SETGID","SETUID"]},"runAsUser":1000320999}}],"restartPolicy":"OnFailure","serviceAccount":"cpd-editor-sa","serviceAccountName":"cpd-editor-sa","terminationGracePeriodSeconds":30,"tolerations":[{"effect":"NoExecute","key":"node.kubernetes.io/not-ready","operator":"Exists","tolerationSeconds":300},{"effect":"NoExecute","key":"node.kubernetes.io/unreachable","operator":"Exists","tolerationSeconds":300}]}}'
wait --for=delete --timeout=5m pod/spark-hb-configmap-update-patch
patch cronjob spark-hb-preload-jkg-image --patch '{ "spec": { "jobTemplate": { "spec": { "template": { "spec": { "containers": [{ "name": "spark-hb-preload-jkg-image1", "image": "{{.DockerRegistryPrefix}}/spark-hb-jkg:2.4.6.v1.1-ppc64le", "command": ["echo", "Image {{.DockerRegistryPrefix}}/spark-hb-jkg:2.4.6.v1.1-ppc64le preloaded"] }, { "name": "spark-hb-preload-jkg-image2", "image": "{{.DockerRegistryPrefix}}/spark-hb-jkg:2.4.6.v1.1-ppc64le", "command": ["echo", "Image {{.DockerRegistryPrefix}}/spark-hb-jkg:2.4.6.v1.1-ppc64le preloaded"]}] } } } } } }'
patch deployment spark-hb-control-plane --patch '{ "spec": { "template": { "spec": { "containers": [{ "name": "spark-hb-control-plane", "image": "{{.DockerRegistryPrefix}}/spark-hb-control-plane:3.0.30.4-ppc64le"}] } } } }'
patch deployment spark-hb-nginx --patch '{ "spec": { "template": { "spec": { "containers": [{ "name": "spark-hb-nginx", "image": "{{.DockerRegistryPrefix}}/spark-hb-nginx:3.0.30.4-ppc64le"}] } } } }'